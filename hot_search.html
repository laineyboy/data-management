<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今日热搜榜单</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .hot-list {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .hot-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .hot-item:hover {
            background-color: #f9f9f9;
        }
        .hot-item.selected {
            background-color: #e6f7ff;
        }
        .ai-content {
            flex: 2;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            color: #1890ff;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #333;
            margin-top: 0;
        }
        .image-container {
            margin-top: 20px;
            text-align: center;
        }
        img {
            max-width: 100%;
            border-radius: 4px;
        }
        .placeholder {
            color: #999;
            text-align: center;
            padding: 40px 0;
        }
        .ai-generated-content {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .ai-generated-content h2 {
            color: #1890ff;
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem;
        }
        .ai-generated-content h3 {
            color: #333;
            font-size: 1.2rem;
            margin: 1.2rem 0 0.8rem;
        }
        .ai-generated-content p {
            margin: 0.8rem 0;
        }
        .ai-generated-content ul {
            padding-left: 20px;
            margin: 0.8rem 0;
        }
        .image-prompt {
            color: #666;
            font-style: italic;
            margin: 10px 0;
            text-align: right;
        }
    </style>
</head>
<body>
    <h1>今日热搜榜单</h1>
    <div class="container">
        <div class="hot-list">
            <h2>热搜列表</h2>
            <div id="hotItems">
                <!-- 热搜项将通过调用 API 动态生成 -->
            </div>
        </div>
        <div class="ai-content">
            <h2>AI 生成内容</h2>
            <div id="contentDisplay" class="placeholder">
                请选择一条热搜新闻，AI 将根据标题生成图文内容
            </div>
        </div>
    </div>

    <script>
        // 渲染热搜列表
        const hotItemsContainer = document.getElementById('hotItems');

        // 获取热搜数据
        async function fetchHotSearch() {
            try {
                const response = await fetch('https://api.freejk.com/shuju/hotlist/baidu');
                if (!response.ok) {
                    throw new Error('网络响应不正常');
                }
                const data = await response.json();
                renderHotList(data.data);
            } catch (error) {
                console.error('获取热搜数据失败:', error);
                hotItemsContainer.innerHTML = '<div class="placeholder">获取热搜数据失败，请检查网络连接</div>';
            }
        }

        // 渲染热搜列表
        function renderHotList(hotData) {
            hotItemsContainer.innerHTML = '';
            hotData.forEach((item, index) => {
                const hotItem = document.createElement('div');
                hotItem.className = 'hot-item';
                hotItem.textContent = `${index + 1}. ${item.title}`;
                hotItem.addEventListener('click', () => {
                    // 移除之前选中的样式
                    document.querySelectorAll('.hot-item').forEach(i => i.classList.remove('selected'));
                    hotItem.classList.add('selected');
                    generateAIContent(item.title);
                });
                hotItemsContainer.appendChild(hotItem);
            });
        }

        // 页面加载完成后获取热搜数据
        window.addEventListener('load', fetchHotSearch);

        // 调用大模型生成内容的函数
        async function generateAIContent(title) {
            const contentDisplay = document.getElementById('contentDisplay');
            contentDisplay.innerHTML = '<div class="placeholder">正在生成内容，请稍候...</div>';
            
            try {
                const response = await fetch('https://vip.apiyi.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-s6lPKTnOSkLA7LkmE2F5559c162048EfBdEbC26aF98102A7'
                    },
                    body: JSON.stringify({
                        "model": "gpt-4o-mini",
                        "stream": false,
                        "messages": [
                            {"role": "system", "content": "请根据提供的热搜标题生成一篇包含图文的内容，要求内容丰富、逻辑清晰。"},
                            {"role": "user", "content": title}
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('大模型 API 请求失败');
                }
                
                const data = await response.json();
                const aiContent = data.choices[0].message.content;
                
                contentDisplay.innerHTML = `
                    <h3>${title}</h3>
                    <div class="ai-generated-content">${formatContent(aiContent)}</div>
                    <div class="image-prompt">生成一张"${title}"的图片</div>
                    <div class="image-container">
                        <div class="placeholder">正在生成图片，请稍候...</div>
                    </div>
                `;
                
                // 调用文生图 API
                try {
                    // 调用豆包大模型文生图API
                    const imageResponse = await fetch('https://wcode.net/api/vision/gpt/text-to-image/v3/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer sk-1190.OyA5peT8PH8D6vIOZTDZ8N5UAYXvXWVko8gQIvkyAOneARZU'
                        },
                        body: JSON.stringify({
                            prompt: `生成一张"${title}"的图片`,
                            model: 'wanx2.1-t2i-plus',
                            width: 1024,
                            height: 1024
                        })
                    });

                    // 检查HTTP响应状态
                    if (!imageResponse.ok) {
                        const errorDetails = await imageResponse.text();
                        throw new Error(`API请求失败: ${imageResponse.status} ${imageResponse.statusText}\n详细信息: ${errorDetails}`);
                    }

                    const imageData = await imageResponse.json();
                    console.log('文生图 API 响应:', imageData);

                    // 解析AI返回的content中的JSON
                    let imageUrl = '';
                    try {
                        // 提取message中的content
                        const aiMessageContent = imageData.choices[0].message.content;
                        // 移除可能的反引号和空格
                        const cleanedContent = aiMessageContent.replace(/[`\s]/g, '');
                        // 解析JSON
                        const contentJson = JSON.parse(cleanedContent);
                        imageUrl = contentJson.image_url;
                    } catch (parseError) {
                        console.error('解析图片URL失败:', parseError);
                    }

                    const imageContainer = contentDisplay.querySelector('.image-container');

                    if (imageUrl) {
                        // 添加图片加载失败处理
                        imageContainer.innerHTML = `<img src="${imageUrl}" alt="AI 生成的图片" style="max-width:100%;border-radius:4px;" onload="this.style.display='block'" onerror="this.src='https://via.placeholder.com/512?text=图片加载失败'">`;
                    } else {
                        imageContainer.innerHTML = `<div class="placeholder">生成图片失败：无法从 API 响应中提取图片 URL<br>响应数据: ${JSON.stringify(imageData)}</div>`;
                    }
                } catch (error) {
                    console.error('文生图 API 错误:', error);
                    const imageContainer = contentDisplay.querySelector('.image-container');
                    imageContainer.innerHTML = `<div class="placeholder">生成图片失败：${error.message}</div>`;
                }
            } catch (error) {
                console.error('生成内容失败:', error);
                contentDisplay.innerHTML = `<div class="placeholder">生成内容失败：${error.message}</div>`;
            }
        }
        // 格式化AI生成的内容，优化排版
        function formatContent(content) {
            // 将### 转换为h4标题
            content = content.replace(/### (.*?)\n/g, '<h4>$1</h4>');
            // 将## 转换为h3标题
            content = content.replace(/## (.*?)\n/g, '<h3>$1</h3>');
            // 将# 转换为h2标题
            content = content.replace(/# (.*?)\n/g, '<h2>$1</h2>');
            // 将换行符转换为段落
            content = content.replace(/\n\n([^#\n]+)/g, '<p>$1</p>');
            // 为列表项添加标记
            content = content.replace(/\n- (.*?)(?=\n|$)/g, '<li>$1</li>');
            // 将连续列表项包装成ul
            content = content.replace(/(<li>.*?<\/li>)+/g, '<ul>$&</ul>');
            return content;
        }
    </script>
</body>
</html>